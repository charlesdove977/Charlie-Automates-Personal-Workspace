---
phase: 01-foundation
plan: 03
type: execute
---

<objective>
Configure Supervisor for 24/7 operation and verify the agent runs correctly.

Purpose: Enable the agent to run persistently with automatic restarts on failure.
Output: Working Supervisor configuration, verified agent operation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
@.planning/phases/01-foundation/01-02-SUMMARY.md

**From research:**
- Supervisor for process management with auto-restart
- SIGTERM for graceful shutdown (agent handles this)
- Logs to stdout/stderr (Supervisor captures them)

**Prerequisites from prior plans:**
- Virtual environment at .venv/
- src/main.py as entry point
- Signal handling implemented
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Supervisor configuration</name>
  <files>supervisor.conf, scripts/start.sh</files>
  <action>
Create `supervisor.conf` for running the agent:

```ini
[program:personal-agi]
command=%(here)s/.venv/bin/python -m src.main
directory=%(here)s
autostart=true
autorestart=true
startsecs=10
startretries=3
stopwaitsecs=30
stopsignal=TERM
stdout_logfile=%(here)s/logs/stdout.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
stderr_logfile=%(here)s/logs/stderr.log
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=5
environment=ANTHROPIC_API_KEY="%(ENV_ANTHROPIC_API_KEY)s"
```

Create `logs/` directory:
```bash
mkdir -p logs
```

Create a helper script `scripts/start.sh` for manual runs:
```bash
#!/bin/bash
# Start Personal AGI agent manually (for development)

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_DIR="$(dirname "$SCRIPT_DIR")"

cd "$PROJECT_DIR"

# Activate virtual environment
source .venv/bin/activate

# Load environment
if [ -f .env ]; then
    export $(grep -v '^#' .env | xargs)
fi

# Run the agent
python -m src.main
```

Make it executable:
```bash
chmod +x scripts/start.sh
```

Create `scripts/` directory if needed:
```bash
mkdir -p scripts
```

**Configuration notes:**
- `%(here)s` = directory containing supervisor.conf
- `startsecs=10` = must run 10s before considered "started"
- `stopwaitsecs=30` = gives agent 30s for graceful shutdown
- `stopsignal=TERM` = sends SIGTERM (which agent handles)
- Log rotation with 5 backups at 10MB each

Do NOT install Supervisor globally - that's user's choice.
Do NOT start Supervisor - just create the config.
  </action>
  <verify>
- `cat supervisor.conf` shows [program:personal-agi] section
- `ls scripts/start.sh` exists and is executable
- `ls logs/` directory exists
  </verify>
  <done>Supervisor config created, start script ready, logs directory exists</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete agent foundation with Supervisor configuration</what-built>
  <how-to-verify>
    1. Create a `.env` file with your API key:
       ```bash
       cp .env.example .env
       # Edit .env and add your ANTHROPIC_API_KEY
       ```

    2. Activate the virtual environment:
       ```bash
       cd /Users/user/Downloads/Development\ Charlie\ 2/Charlieautomates/apps/personal-agi
       source .venv/bin/activate
       ```

    3. Run the agent in interactive mode:
       ```bash
       python -m src.main
       ```

    4. Test with a simple prompt:
       ```
       You: What files are in this directory?
       ```

    5. Verify the agent:
       - Responds with file listing
       - Uses tools (you'll see tool usage in output)
       - Logs show structured output

    6. Test graceful shutdown:
       - Press Ctrl+C
       - Verify "shutdown_signal_received" appears in logs
       - Agent exits cleanly

    7. (Optional) Test with Supervisor:
       ```bash
       pip install supervisor
       supervisord -c supervisor.conf
       # In another terminal:
       supervisorctl -c supervisor.conf status
       supervisorctl -c supervisor.conf stop personal-agi
       ```
  </how-to-verify>
  <resume-signal>Type "approved" if agent works correctly, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] supervisor.conf exists with correct configuration
- [ ] scripts/start.sh exists and is executable
- [ ] logs/ directory created
- [ ] Agent runs in interactive mode (human verified)
- [ ] Agent handles shutdown gracefully (human verified)
</verification>

<success_criteria>
- Supervisor configuration complete
- Agent verified working by human
- Graceful shutdown confirmed
- Phase 1: Foundation complete
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-03-SUMMARY.md` with:
- Confirmation of agent operation
- Any issues encountered during verification
- Note that Phase 1 is complete, ready for Phase 2 (Telegram communication)
</output>
