---
phase: 02-communication
plan: 01
type: execute
---

<objective>
Set up Telegram bot dependencies and configuration.

Purpose: Prepare the project for Telegram integration with proper credentials management.
Output: Updated requirements, config ready for Telegram bot token.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-communication/02-RESEARCH.md
@.planning/phases/01-foundation/01-03-SUMMARY.md

**From research:**
- Use python-telegram-bot v22.5+ (async, well-maintained)
- Direct integration (NOT MCP middleware)
- User whitelist required for security

**Prerequisites from Phase 1:**
- Virtual environment at .venv/
- src/config.py with validate_config()
- PersonalAGI class in src/agent.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Telegram dependencies</name>
  <files>requirements.txt</files>
  <action>
Add python-telegram-bot to requirements.txt:

```
python-telegram-bot>=22.5
```

Then install:
```bash
source .venv/bin/activate && pip install -r requirements.txt
```

Verify installation works.
  </action>
  <verify>
- `pip list | grep python-telegram-bot` shows 22.5+
- `python -c "from telegram import Update; print('OK')"` works
  </verify>
  <done>python-telegram-bot installed and importable</done>
</task>

<task type="auto">
  <name>Task 2: Update configuration for Telegram</name>
  <files>src/config.py, .env.example</files>
  <action>
Update `.env.example` to include Telegram settings:

```
ANTHROPIC_API_KEY=your-api-key-here
TELEGRAM_BOT_TOKEN=your-bot-token-from-botfather
TELEGRAM_OWNER_ID=your-telegram-user-id
```

Update `src/config.py` to load and validate Telegram config:

```python
"""Configuration management for Personal AGI."""
import os
import shutil
from dotenv import load_dotenv

load_dotenv()

ANTHROPIC_API_KEY = os.getenv("ANTHROPIC_API_KEY")
TELEGRAM_BOT_TOKEN = os.getenv("TELEGRAM_BOT_TOKEN")
TELEGRAM_OWNER_ID = os.getenv("TELEGRAM_OWNER_ID")


def validate_config() -> bool:
    """Validate required configuration is present."""
    # Check if Claude Code CLI is available (for Max subscribers)
    claude_available = shutil.which("claude") is not None

    if not ANTHROPIC_API_KEY and not claude_available:
        print("ERROR: No authentication found")
        print("Either:")
        print("  1. Set ANTHROPIC_API_KEY in .env file, OR")
        print("  2. Authenticate with Claude Code (claude auth)")
        return False

    if not ANTHROPIC_API_KEY:
        print("Note: Using Claude Code authentication (Max subscription)")

    return True


def validate_telegram_config() -> bool:
    """Validate Telegram configuration is present."""
    if not TELEGRAM_BOT_TOKEN:
        print("ERROR: TELEGRAM_BOT_TOKEN not set")
        print("Create a bot via @BotFather and add token to .env")
        return False

    if not TELEGRAM_OWNER_ID:
        print("ERROR: TELEGRAM_OWNER_ID not set")
        print("Get your Telegram user ID and add to .env")
        return False

    try:
        int(TELEGRAM_OWNER_ID)
    except ValueError:
        print("ERROR: TELEGRAM_OWNER_ID must be a number")
        return False

    return True
```

Do NOT change validate_config() behavior for non-Telegram mode.
  </action>
  <verify>
- `cat .env.example` shows TELEGRAM_BOT_TOKEN and TELEGRAM_OWNER_ID
- `python -c "from src.config import validate_telegram_config; print('OK')"` works
  </verify>
  <done>Config updated with Telegram settings, validation function added</done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <action>Create Telegram bot and get credentials</action>
  <instructions>
I've set up the configuration. Now you need to create a Telegram bot:

1. **Create bot via BotFather:**
   - Open Telegram, search for @BotFather
   - Send `/newbot`
   - Choose a display name (e.g., "Personal AGI")
   - Choose a username (must end in 'bot', e.g., `yourname_agi_bot`)
   - Copy the token (looks like `123456789:ABCdefGHI...`)

2. **Get your Telegram user ID:**
   - Search for @userinfobot in Telegram
   - Send `/start`
   - Copy your user ID (a number like `123456789`)

3. **Create .env file:**
   ```bash
   cd /Users/user/Downloads/Development\ Charlie\ 2/Charlieautomates/apps/personal-agi
   cp .env.example .env
   ```
   Edit .env and fill in:
   - TELEGRAM_BOT_TOKEN=your-token-from-step-1
   - TELEGRAM_OWNER_ID=your-id-from-step-2
  </instructions>
  <verification>
After you complete this, I'll verify the config loads correctly.
  </verification>
  <resume-signal>Type "done" when you've created the bot and updated .env</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] python-telegram-bot>=22.5 installed
- [ ] .env.example has Telegram settings
- [ ] src/config.py has validate_telegram_config()
- [ ] User has created bot and .env file
</verification>

<success_criteria>
- Dependencies installed
- Configuration ready
- Bot token obtained from user
- Ready for bot implementation
</success_criteria>

<output>
After completion, create `.planning/phases/02-communication/02-01-SUMMARY.md` with:
- Dependencies added
- Config changes made
- Bot credentials obtained
</output>
