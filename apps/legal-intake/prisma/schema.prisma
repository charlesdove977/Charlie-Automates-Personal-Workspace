// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// =============================================================================
// ENUMS
// =============================================================================

enum UserRole {
  ADMIN
  ATTORNEY
}

enum CaseStatus {
  PENDING
  ACCEPTED
  REJECTED
}

enum ProcessingStatus {
  QUEUED
  EXTRACTING
  ANALYZING
  COMPLETE
  FAILED
}

// =============================================================================
// MODELS
// =============================================================================

model Firm {
  id           String   @id @default(cuid())
  name         String
  slug         String   @unique
  logo         String?
  primaryColor String   @default("#1a365d")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  users       User[]
  cases       Case[]
  fitCriteria FitCriteria[]
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  name         String
  passwordHash String?  // Optional for migration; required for login
  role         UserRole @default(ATTORNEY)
  firmId       String
  firm         Firm     @relation(fields: [firmId], references: [id])
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([firmId])
}

model Case {
  id           String     @id @default(cuid())
  firmId       String
  firm         Firm       @relation(fields: [firmId], references: [id])
  status       CaseStatus @default(PENDING)

  // Client info
  clientName   String
  clientEmail  String
  clientPhone  String?

  // Case details
  caseType     String?
  jurisdiction String?

  // AI analysis results (populated by Phase 3)
  briefJson    Json?
  fitScore     Int?

  // Processing status (populated by Phase 3)
  processingStatus ProcessingStatus @default(QUEUED)
  processingError  String?
  processedAt      DateTime?

  // Timestamps
  submittedAt  DateTime   @default(now())
  reviewedAt   DateTime?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  documents    Document[]

  @@index([firmId])
  @@index([status])
}

model Document {
  id            String   @id @default(cuid())
  caseId        String
  case          Case     @relation(fields: [caseId], references: [id], onDelete: Cascade)

  filename      String
  mimeType      String
  sizeBytes     Int
  storageUrl    String   // Supabase storage URL

  // Extracted content (populated by Phase 3)
  extractedText String?

  createdAt     DateTime @default(now())

  @@index([caseId])
}

model FitCriteria {
  id          String   @id @default(cuid())
  firmId      String
  firm        Firm     @relation(fields: [firmId], references: [id])

  name        String
  description String?
  weight      Int      @default(1)
  isActive    Boolean  @default(true)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([firmId])
}
