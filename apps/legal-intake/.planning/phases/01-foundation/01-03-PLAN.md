---
phase: 01-foundation
plan: 03
type: execute
---

<objective>
Create the API route structure and configure Vercel deployment.

Purpose: Establish API patterns and deployment pipeline so the app can be deployed and iterated on quickly.
Output: Working health endpoint, API utilities, and Vercel deployment configuration.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
@.planning/phases/01-foundation/01-02-SUMMARY.md

**API considerations:**
- Next.js App Router API routes
- Standard JSON responses
- Health endpoint for monitoring
- Error handling utilities

**Deployment:**
- Vercel (free tier, automatic deployments)
- Environment variables managed in Vercel dashboard
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create API route structure</name>
  <files>src/app/api/health/route.ts, src/lib/api.ts</files>
  <action>
    Set up API foundation:

    1. Create `src/lib/api.ts` with response utilities:
       ```typescript
       import { NextResponse } from 'next/server'

       export function jsonResponse<T>(data: T, status = 200) {
         return NextResponse.json(data, { status })
       }

       export function errorResponse(message: string, status = 500) {
         return NextResponse.json({ error: message }, { status })
       }

       export function notFound(message = 'Not found') {
         return errorResponse(message, 404)
       }

       export function badRequest(message = 'Bad request') {
         return errorResponse(message, 400)
       }

       export function unauthorized(message = 'Unauthorized') {
         return errorResponse(message, 401)
       }
       ```

    2. Create `src/app/api/health/route.ts`:
       ```typescript
       import { jsonResponse } from '@/lib/api'

       export async function GET() {
         return jsonResponse({
           status: 'ok',
           timestamp: new Date().toISOString(),
           version: process.env.npm_package_version || '0.1.0'
         })
       }
       ```

    3. Create directory structure for future API routes:
       - `src/app/api/cases/` (empty, for Phase 2)
       - `src/app/api/firms/` (empty, for Phase 5)

    DO NOT add authentication middleware yet - that comes in Phase 4.
    DO NOT over-engineer error handling - keep it simple.
  </action>
  <verify>
    pnpm dev, then:
    curl http://localhost:3000/api/health
    Should return: {"status":"ok","timestamp":"...","version":"0.1.0"}
  </verify>
  <done>Health endpoint returns 200 with status JSON, API utilities available</done>
</task>

<task type="auto">
  <name>Task 2: Configure Vercel deployment</name>
  <files>vercel.json, .env.example</files>
  <action>
    Set up Vercel deployment:

    1. Create `vercel.json`:
       ```json
       {
         "$schema": "https://openapi.vercel.sh/vercel.json",
         "framework": "nextjs",
         "regions": ["iad1"],
         "headers": [
           {
             "source": "/api/(.*)",
             "headers": [
               { "key": "Cache-Control", "value": "no-store" }
             ]
           }
         ]
       }
       ```

    2. Update `README.md` to add deployment section:
       ```markdown
       ## Deployment

       This app deploys to Vercel.

       1. Push to main branch
       2. Vercel auto-deploys
       3. Set environment variables in Vercel dashboard

       Required env vars:
       - DATABASE_URL
       - DIRECT_URL
       - NEXT_PUBLIC_SUPABASE_URL
       - NEXT_PUBLIC_SUPABASE_ANON_KEY
       - SUPABASE_SERVICE_ROLE_KEY
       - ANTHROPIC_API_KEY
       ```

    DO NOT set up preview deployments or complex CI/CD yet - keep it simple.
    DO NOT run `vercel` CLI to deploy - that requires user authentication.
  </action>
  <verify>
    cat vercel.json - should show valid config
    pnpm build - should still succeed
    cat README.md - should include deployment section
  </verify>
  <done>Vercel config exists, README has deployment instructions</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm build` succeeds
- [ ] `curl localhost:3000/api/health` returns valid JSON
- [ ] `vercel.json` exists with valid config
- [ ] `src/lib/api.ts` exports response utilities
- [ ] API directory structure created
- [ ] README includes deployment instructions
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Health endpoint works
- Project ready for Vercel deployment
- Phase 1: Foundation complete
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-03-SUMMARY.md` with:
- Note that Phase 1 is complete
- List all files created across all 3 plans
- Ready for Phase 2: Client Intake Interface
</output>
