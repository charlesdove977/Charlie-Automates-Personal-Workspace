---
phase: 02-client-intake
plan: 01
type: execute
---

<objective>
Set up Supabase client utilities and storage configuration for document uploads.

Purpose: Enable secure file upload to Supabase Storage from the Next.js client.
Output: Working Supabase client with storage bucket ready for document uploads.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context (from frontmatter):
@.planning/phases/01-foundation/01-01-SUMMARY.md
@.planning/phases/01-foundation/01-02-SUMMARY.md

# Key files:
@src/lib/db.ts
@.env.example

**Tech stack available:** Next.js 16.1.1, React 19, Tailwind 4, Prisma 7, TypeScript
**Established patterns:** App Router, server components, Prisma singleton, API response utilities

**Constraining decisions:**
- Multi-tenant by firmId (all entities linked to Firm)
- Supabase for database and storage
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Supabase client and create utilities</name>
  <files>package.json, src/lib/supabase/client.ts, src/lib/supabase/server.ts</files>
  <action>
1. Install @supabase/ssr package: `pnpm add @supabase/ssr`
2. Create src/lib/supabase/client.ts - browser client using createBrowserClient:
   - Export function that creates client with NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY
   - Use 'use client' directive at top
3. Create src/lib/supabase/server.ts - server client using createServerClient:
   - Export async function for server components/route handlers
   - Use cookies() from next/headers
   - Handle cookie get/set/remove operations

NOTE: Use @supabase/ssr (NOT @supabase/auth-helpers-nextjs which is deprecated for Next.js 14+)
  </action>
  <verify>pnpm build succeeds, imports resolve without TypeScript errors</verify>
  <done>@supabase/ssr installed, client.ts and server.ts export working Supabase client functions</done>
</task>

<task type="auto">
  <name>Task 2: Update environment configuration and document storage setup</name>
  <files>.env.example, README.md</files>
  <action>
1. Update .env.example with required Supabase Storage variables:
   - NEXT_PUBLIC_SUPABASE_URL (already present, verify)
   - NEXT_PUBLIC_SUPABASE_ANON_KEY (already present, verify)
   - SUPABASE_SERVICE_ROLE_KEY (add for server-side storage operations)
2. Update README.md with Supabase Storage setup instructions:
   - Create a storage bucket named "case-documents" in Supabase dashboard
   - Set bucket to private
   - Add RLS policy: allow insert when bucket_id = 'case-documents' (public access for now, auth in Phase 4)
   - Document the expected file path pattern: `{firmId}/{caseId}/{filename}`
  </action>
  <verify>README includes clear Supabase Storage setup steps, .env.example has all required variables</verify>
  <done>.env.example updated with SUPABASE_SERVICE_ROLE_KEY, README documents storage bucket setup</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm build` succeeds without errors
- [ ] `pnpm lint` passes
- [ ] Supabase client imports work: `import { createClient } from '@/lib/supabase/client'`
- [ ] Server client imports work: `import { createServerClient } from '@/lib/supabase/server'`
</verification>

<success_criteria>

- @supabase/ssr installed and configured
- Browser and server Supabase clients ready for use
- Storage setup documented in README
- All TypeScript checks pass
</success_criteria>

<output>
After completion, create `.planning/phases/02-client-intake/02-01-SUMMARY.md` following the summary template.
</output>
