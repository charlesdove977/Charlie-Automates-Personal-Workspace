---
phase: 04-attorney-dashboard
plan: 03
type: execute
---

<objective>
Build the case brief viewer that displays AI-generated analysis.

Purpose: Attorneys need to review case briefs quickly to make accept/reject decisions. This is the core product screen.
Output: Case detail page with full brief display, fit score visualization, and document list.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-attorney-dashboard/04-01-SUMMARY.md
@.planning/phases/04-attorney-dashboard/04-02-SUMMARY.md

@prisma/schema.prisma
@src/types/case-brief.ts
@src/lib/analysis.ts

**Tech stack available:** Next.js 16, Prisma 7, Tailwind CSS
**Established patterns:** CaseBrief type structure, ProcessingBadge component
**Constraining decisions:**
- AI Philosophy: Summarize not advise, extract facts not opinions, flag uncertainty
- UX Philosophy: Boring, safe, professional UI

**CaseBrief structure:**
- caseType: { primary, secondary[], confidence }
- jurisdiction: { state, county, confidence, source }
- parties: { petitioner, respondent, children[], otherParties[] }
- timeline: [{ date, description, source, confidence }]
- keyFacts: [{ fact, category, importance, source, confidence }]
- redFlags: [{ issue, severity, details, source }]
- summary: string
- uncertainties: [{ area, reason, needsHumanReview }]
- analysisMetadata: { documentCount, totalTextLength, processingTime, modelUsed, timestamp }
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create case detail page with routing</name>
  <files>src/app/dashboard/cases/[caseId]/page.tsx, src/app/api/dashboard/cases/[caseId]/route.ts</files>
  <action>
Create GET /api/dashboard/cases/[caseId] endpoint:
- Requires auth (check session)
- Validate caseId belongs to user's firm (multi-tenant)
- Return full case data including:
  - Case fields (id, clientName, clientEmail, clientPhone, caseType, jurisdiction, status, fitScore, processingStatus, processingError, submittedAt)
  - briefJson (parsed as CaseBrief type)
  - documents (id, filename, mimeType, sizeBytes)
- Return 404 if case not found or wrong firm

Create case detail page /dashboard/cases/[caseId]:
- Fetch case from API
- Loading state while fetching
- Error state if case not found
- If processingStatus !== COMPLETE: Show ProcessingBadge + "Analysis in progress" message with auto-refresh
- If processingStatus === FAILED: Show error message with processingError
- If processingStatus === COMPLETE: Render full brief

Page layout:
- Back button to inbox
- Header with client name, case type, submitted date
- Fit score prominently displayed
- Brief content below
  </action>
  <verify>
- Navigate to /dashboard/cases/[valid-caseId] → page loads
- Invalid caseId → 404 error displayed
- Case from different firm → 404 (multi-tenant check)
  </verify>
  <done>Case detail page loads with correct data, routing works</done>
</task>

<task type="auto">
  <name>Task 2: Build brief display components</name>
  <files>src/components/brief/BriefDisplay.tsx, src/components/brief/PartiesSection.tsx, src/components/brief/TimelineSection.tsx, src/components/brief/KeyFactsSection.tsx, src/components/brief/RedFlagsSection.tsx, src/components/brief/UncertaintiesSection.tsx, src/components/brief/FitScoreCard.tsx</files>
  <action>
Create BriefDisplay component (orchestrates all sections):
- Takes CaseBrief as prop
- Renders sections in logical order for attorney review

Create FitScoreCard component:
- Large score display (e.g., "72")
- Color-coded background: green ≥70, yellow 50-69, red <50
- Label: "Fit Score"
- Tooltip explaining what it means

Create PartiesSection:
- Card with petitioner, respondent info
- Children list if present
- Confidence badges (high=green, medium=yellow, low=red)
- "Details" expandable for each party

Create TimelineSection:
- Vertical timeline UI
- Date + description for each event
- Source reference (which document)
- Confidence indicator

Create KeyFactsSection:
- Grouped by category (financial, custody, property, etc.)
- Importance badges (high/medium/low)
- Collapsible category groups
- Each fact shows source + confidence

Create RedFlagsSection:
- Prominent red/warning styling
- Severity badges
- Each flag shows issue, details, source
- This is CRITICAL for attorneys - make it stand out

Create UncertaintiesSection:
- Yellow/warning styling
- List areas that need human review
- Flag items where needsHumanReview === true more prominently

Design notes:
- Clean, scannable layout
- Attorneys should be able to review in under 2 minutes
- Use consistent card/section styling
- Confidence levels always visible but not overwhelming
  </action>
  <verify>
- All brief sections render correctly
- Confidence badges display
- Red flags section is prominent and readable
- Timeline is chronological
  </verify>
  <done>Brief displays all sections with proper formatting and confidence indicators</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete case brief viewer with all sections (parties, timeline, facts, red flags, uncertainties, fit score)</what-built>
  <how-to-verify>
    1. Run: pnpm dev
    2. Login to dashboard
    3. Click on a case that has processingStatus=COMPLETE
    4. Verify the brief displays:
       - Fit score card with correct color
       - Parties section with names and confidence
       - Timeline in chronological order
       - Key facts grouped by category
       - Red flags prominently displayed
       - Uncertainties section visible
    5. Confirm the layout is professional and scannable
    6. Verify confidence badges are readable but not distracting
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Case detail page loads correctly
- [ ] Brief renders all sections
- [ ] Fit score displays with correct color coding
- [ ] Red flags are prominently visible
- [ ] Confidence levels shown throughout
- [ ] Multi-tenant isolation works (can't view other firms' cases)
- [ ] `pnpm build` passes
</verification>

<success_criteria>
- Case brief viewer is complete and professional
- All CaseBrief fields are displayed appropriately
- Red flags and uncertainties are clearly visible
- Layout supports quick attorney review (<2 min goal)
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-attorney-dashboard/04-03-SUMMARY.md`
</output>
