---
phase: 04-attorney-dashboard
plan: 04
type: execute
---

<objective>
Implement accept and reject actions for case decisions.

Purpose: Attorneys need to act on cases - accepting for consultation or rejecting with a professional response.
Output: Working accept/reject buttons with confirmation, status updates, and auto-generated reject response.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-attorney-dashboard/04-01-SUMMARY.md
@.planning/phases/04-attorney-dashboard/04-02-SUMMARY.md
@.planning/phases/04-attorney-dashboard/04-03-SUMMARY.md

@prisma/schema.prisma
@src/types/case-brief.ts
@src/app/dashboard/cases/[caseId]/page.tsx

**Tech stack available:** Next.js 16, Prisma 7, Tailwind CSS
**Established patterns:** API routes with Cache-Control, multi-tenant by firmId
**Constraining decisions:**
- CaseStatus enum: PENDING, ACCEPTED, REJECTED
- AI Philosophy: AI never interprets law or recommends action

**Requirements from PROJECT.md:**
- Accept button → book consult flow
- Reject button → auto-generated response
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add accept/reject buttons with confirmation dialogs</name>
  <files>src/components/brief/ActionButtons.tsx, src/components/ui/ConfirmDialog.tsx, src/app/dashboard/cases/[caseId]/page.tsx</files>
  <action>
Create ConfirmDialog component (reusable):
- Modal overlay
- Title, message, confirm/cancel buttons
- Customizable button text and colors
- onConfirm and onCancel callbacks
- Close on escape key and overlay click

Create ActionButtons component:
- Two buttons: "Accept Case" (green) and "Reject Case" (red)
- Only show when case.status === PENDING and processingStatus === COMPLETE
- Accept button onClick → show confirm dialog:
  - Title: "Accept Case"
  - Message: "Accept this case and schedule a consultation with {clientName}?"
  - Confirm: "Accept & Schedule"
- Reject button onClick → show confirm dialog:
  - Title: "Reject Case"
  - Message: "Reject this case? An automated response will be sent to {clientEmail}."
  - Confirm: "Reject & Send Response"

If case.status !== PENDING, show status badge instead:
- ACCEPTED: Green badge "Accepted on {date}"
- REJECTED: Red badge "Rejected on {date}"

Add ActionButtons to case detail page below the header.
  </action>
  <verify>
- Buttons appear on pending cases
- Clicking shows confirmation dialog
- Cancel closes dialog without action
- Status badge shows for non-pending cases
  </verify>
  <done>Accept/reject buttons render with confirmation dialogs</done>
</task>

<task type="auto">
  <name>Task 2: Create action API endpoints</name>
  <files>src/app/api/dashboard/cases/[caseId]/accept/route.ts, src/app/api/dashboard/cases/[caseId]/reject/route.ts</files>
  <action>
Create POST /api/dashboard/cases/[caseId]/accept:
- Requires auth
- Validate case belongs to user's firm
- Validate case.status === PENDING (can't accept already processed)
- Update case:
  - status: ACCEPTED
  - reviewedAt: new Date()
- Return updated case
- Future: This would trigger calendar booking flow (placeholder for now)

Create POST /api/dashboard/cases/[caseId]/reject:
- Requires auth
- Validate case belongs to user's firm
- Validate case.status === PENDING
- Update case:
  - status: REJECTED
  - reviewedAt: new Date()
- Generate rejection response (see Task 3)
- Return updated case + generated response

Both endpoints:
- Return 400 if case not in PENDING status
- Return 404 if case not found or wrong firm
- Return 200 with updated case on success
  </action>
  <verify>
- POST to /accept updates status to ACCEPTED
- POST to /reject updates status to REJECTED
- Can't accept/reject already-processed cases (400 error)
- Multi-tenant check prevents cross-firm actions
  </verify>
  <done>API endpoints update case status correctly with validation</done>
</task>

<task type="auto">
  <name>Task 3: Implement response flow with auto-generated message</name>
  <files>src/lib/responses.ts, src/app/api/dashboard/cases/[caseId]/reject/route.ts, src/components/brief/ActionButtons.tsx</files>
  <action>
Create src/lib/responses.ts:
- generateRejectionResponse(case, brief) function
- Returns professional, empathetic rejection message
- Template-based (no AI call needed for MVP):
  ```
  Dear {clientName},

  Thank you for contacting {firmName} regarding your {caseType} matter.

  After reviewing your submission, we have determined that we are unable to take on your case at this time. This decision is based on our current capacity and case selection criteria, and is not a reflection of the merits of your situation.

  We recommend consulting with other qualified attorneys in your area who may be better positioned to assist you.

  We wish you the best in resolving your legal matter.

  Sincerely,
  {firmName}
  ```
- Store response in case record (add responseText field to Case model if needed)

Update reject endpoint:
- Generate response using template
- Store in case.responseText (or similar field)
- Return response in API response

Update ActionButtons:
- After successful accept: Show success toast, redirect to inbox
- After successful reject: Show success toast with "Response sent" message, redirect to inbox
- Handle loading states during API calls
- Handle error states (show error toast)

Note: Actual email sending is out of scope for this phase. The response is generated and stored; email integration would be Phase 5 or later.
  </action>
  <verify>
- Accept action updates case and redirects to inbox
- Reject action generates response and stores it
- Success/error feedback shown to user
- Case list reflects updated status
  </verify>
  <done>Accept/reject flow complete with response generation and user feedback</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Accept button works and updates case to ACCEPTED
- [ ] Reject button works and updates case to REJECTED
- [ ] Rejection response is generated and stored
- [ ] Confirmation dialogs work correctly
- [ ] Success/error feedback displays
- [ ] Case list updates to reflect new status
- [ ] Can't accept/reject non-pending cases
- [ ] `pnpm build` passes
</verification>

<success_criteria>
- Accept/reject workflow is complete
- Status updates persist correctly
- Rejection response is professional and stored
- User feedback is clear
- No TypeScript errors
- Phase 4 complete: Attorney dashboard fully functional
</success_criteria>

<output>
After completion, create `.planning/phases/04-attorney-dashboard/04-04-SUMMARY.md`:

Include note: "Phase 4 complete, ready for Phase 5"
</output>
